<div class="modal-header">
    <h4>{{$ctrl.file.filename }}</h4>
</div>
<div class="modal-body col-md-12" style="display: flex;">
    <div class="col-md-7 external-container" style="align-items: stretch;">
        <div class="hg-100" ng-switch="$ctrl.mimeType">
            <div class="hg-100" ng-switch-when="image">
                <img ng-src="{{$ctrl.file.url}}" id="file-modal" />
                <div class="external-content">
                    <a ng-href="{{$ctrl.file.url}}" target="_blank">
                        <dfn title="Open {{ $ctrl.file.filename }} in a new tab">
                            <i class="material-icons" aria-hidden="true">open_in_new</i>
                        </dfn>
                    </a>
                </div>
            </div>
            <div class="hg-100" ng-switch-when="pdf" ng-controller="pdfCtrl" ng-init="pdfUrl=$ctrl.file.url">
                <ng-pdf template-url="layouts/pdf.html"></ng-pdf>
                <div class="progress animated-item" ng-if="status.progress < 100">
                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: {{ status.progress }}%">
                        {{ status.progress }}%
                    </div>
                </div>
            </div>
            <div ng-switch-when="audio">
                <audio controls class="width-90">
                    <source ng-src="{{$ctrl.file.url}}" />
                </audio>
            </div>
            <div ng-switch-when="video">
                <video controls class="width-90">
                    <source ng-src="{{$ctrl.file.url}}" />
                </video>
            </div>
            <div class="hg-100" ng-switch-when="3d" ng-controller="threeCtrl">
                <div class="hg-100" id="threejs-container" ng-init="initThree($ctrl.file.url)">
                    <div style="position: absolute; top: 10px; left: 10px;">
                        <button class="btn btn-primary" style="display: block;" ng-click="zoomOut()"><i class="material-icons">zoom_out</i></button>
                        <button class="btn btn-primary" style="display: block;" ng-click="zoomIn()"><i class="material-icons">zoom_in</i></button>
                        <button class="btn btn-primary" style="display: block;" ng-click="toggleMeasurement()"><i class="material-icons">straighten</i></button>
                    </div>
                </div>
                <p>
                    Gemessene LÃ¤nge: {{ props.length }}m
                </p>
                <div class="progress animated-item" ng-if="status.progress < 100">
                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: {{ status.progress }}%">
                        {{ status.progress }}%
                    </div>
                </div>
            </div>
            <div ng-switch-default ng-controller="pdfCtrl">
                <div ng-if="$ctrl.file.filename.endsWith('.md')">
                    <button type="button" class="btn btn-default" ng-click="togglePreview()">
                        <span translate="files.properties.md-preview.toggle"></span>
                    </button>
                </div>
                <div ng-if="!isPreview" class="left scrollable-modal" hljs hljs-include="$ctrl.file.url">
                </div>
                <div ng-if="isPreview" class="left scrollable-modal" marked src="$ctrl.file.url">
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-5" style="align-items: stretch;" ng-init="activeTab = 'props'">
        <ul class="nav nav-tabs nav-justified">
            <li role="presentation" ng-class="{active: activeTab == 'props'}" ng-click="activeTab = 'props'">
                <a>
                    <i class="material-icons">tune</i> {{'files.properties.heading'|translate}}
                </a>
            </li>
            <li role="presentation" ng-class="{active: activeTab == 'links'}" ng-click="activeTab = 'links'">
                <a>
                    <i class="material-icons">link</i> {{'files.linkages.heading'|translate}}
                </a>
            </li>
            <li role="presentation" ng-class="{active: activeTab == 'exif'}" ng-click="activeTab = 'exif'">
                <a>
                    <i class="material-icons">camera</i> {{ 'files.exif.heading'|translate}}
                </a>
            </li>
        </ul>
        <div ng-show="activeTab == 'props'" class="col-md-10 col-md-offset-1">
            <h3>{{'files.properties.heading'|translate}}</h3>
            <table class="table" style="width: 100%;">
                <tr ng-repeat="prop in $ctrl.availableProperties" ng-mouseenter="hovered=true;" ng-mouseleave="hovered=false;">
                    <td style="text-align:left; font-weight: bold;">
                        {{'files.properties.file.'+prop|translate}}
                    </td>
                    <td style="text-align:right;">
                        <div ng-show="!$ctrl.fileEdits[prop].editMode">
                            <a class="btn btn-default btn-fab btn-fab-minime" href="" ng-click="$ctrl.setFilePropertyEdit($ctrl.fileEdits, prop, $ctrl.file[prop])" ng-if="hovered">
                                <i class="material-icons md-18 fa-green">edit</i>
                            </a>
                            <i>
                                <i style="color: gray;">
                                    {{ $ctrl.file[prop] }}
                                </i>
                            </i>
                        </div>
                        <div ng-if="$ctrl.fileEdits[prop].editMode">
                            <a class="btn btn-success btn-fab btn-fab-minime" href="" ng-click="$ctrl.storeFilePropertyEdit($ctrl.fileEdits, prop, $ctrl.file)">
                                <i class="material-icons md-18">check</i>
                            </a>
                            <a class="btn btn-danger btn-fab btn-fab-minime" href="" ng-click="$ctrl.cancelFilePropertyEdit($ctrl.fileEdits, prop)">
                                <i class="material-icons md-18">clear</i>
                            </a>
                            <input type="text" class="inline-edit" style="text-align: right;" ng-model="$ctrl.fileEdits[prop].text" />
                        </div>
                    </td>
                </tr>
            </table>
            <h3>{{'files.properties.file.heading'|translate}}</h3>
            <table class="table" style="width: 100%;">
                <tr>
                    <td style="text-align:left; font-weight: bold;">
                        {{'files.properties.file.created'|translate}}
                    </td>
                    <td style="text-align:right;">
                        <i style="color: gray;">{{ $ctrl.file.created*1000 | date:'d.MM.yyyy H:mm:ss' }}</i>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left; font-weight: bold;">
                        {{'files.properties.file.modified'|translate}}
                    </td>
                    <td style="text-align:right;">
                        <i style="color: gray;">{{ $ctrl.file.modified*1000 | date:'d.MM.yyyy H:mm:ss' }}</i>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left; font-weight: bold;">
                        {{'files.properties.file.cameraname'|translate}}
                    </td>
                    <td style="text-align:right;">
                        <i style="color: gray;">{{ $ctrl.file.cameraname }}</i>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left; font-weight: bold;">
                        {{'files.properties.file.filesize'|translate}}
                    </td>
                    <td style="text-align:right;">
                        <i style="color: gray;">{{ $ctrl.file.filesize | bytes:2 }}</i>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:left; font-weight: bold;">{{'files.properties.file.orientation'|translate}}</td>
                    <td style="text-align:right;"><i style="color: gray;">{{ $ctrl.file.orientation }}</i></td>
                </tr>
            </table>
            <h3 translate="tags.name"></h3>
            <div>
                <div class="form-group label-floating">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <i class="material-icons">local_offer</i>
                        </span>
                       <ui-select multiple tagging tagging-label="false" ng-model="$ctrl.file.tags" on-select="addTag($ctrl.file, $item)" on-remove="removeTag($ctrl.file, $item)" theme="bootstrap" sortable="true" close-on-select="false">
                           <ui-select-match placeholder="{{ 'tags.add' | translate }}">
                               {{ $item.label }}
                           </ui-select-match>
                           <ui-select-choices repeat="tag in $ctrl.availableTags | filter:$select.search">
                               {{ tag.label }}
                           </ui-select-choices>
                       </ui-select>
                    </div>
                </div>
            </div>
        </div>
        <div ng-show="activeTab == 'links'">
            <h3>{{'files.linkages.heading'|translate}}</h3>
            <ul class="list-group">
                <li class="list-group-item" ng-repeat="lc in $ctrl.file.linked_contexts">
                    <a ui-sref="root.spacialist.data({id: lc.id })" ui-sref-opts="{reload: true}">
                        {{ lc.name }}
                    </a>
                </li>
            </ul>
        </div>
        <div ng-show="activeTab == 'exif'">
            <p class="alert alert-info" ng-if="!$ctrl.file.exif" translate="files.exif.no-data">
            </p>
            <table class="exif-table" ng-if="$ctrl.file.exif">
                <tr>
                    <td>
                        <i class="material-icons">photo_camera</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.IFD0.Model }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">camera</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.COMPUTED.ApertureFNumber }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">lens</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.EXIF.FocalLength | floatify }}mm
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">timer</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.EXIF.ExposureTime }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">iso</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.EXIF.ISOSpeedRatings }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <!-- EXIF.Flash is hex, trailing 0 means no flash -->
                        <i class="material-icons" ng-if="$ctrl.file.exif.EXIF.Flash % 2 == 0">flash_off</i>
                        <i class="material-icons" ng-if="$ctrl.file.exif.EXIF.Flash % 2 == 1">flash_on</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.EXIF.Flash }} (TODO: parse status code)
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">access_time</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.EXIF.DateTimeOriginal }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">brightness_6</i>
                    </td>
                    <td>
                        Whitebalance
                    </td>
                </tr>
                <tr>
                    <td>
                        <i class="material-icons">copyright</i>
                    </td>
                    <td>
                        {{ $ctrl.file.exif.EXIF.Copyright }}
                    </td>
                </tr>
            </table>
         </div>
    </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default"
      ng-click="$ctrl.close()">{{ 'close' | translate }}</button>
</div>
