<div ng-init="useFunc = false;">
    <div style="text-align: right;">
        <a href="" ng-click="$ctrl.closePopover($event)">
            <i class="material-icons md-dark">clear</i>
        </a>
    </div>
    <form class="form-horizontal">
        <div class="form-group" ng-if="$ctrl.attributeColumns.length > 0">
            <label class="control-label col-md-2" translate="analysis.popup.attribute"></label>:
            <div class="col-md-10">
                <ui-select ng-model="$ctrl.tmpAttribute" on-select="$ctrl.getSubPopover($item, $ctrl.relation)">
                    <ui-select-match allow-clear="false">
                        {{ $ctrl.concepts[$select.selected.thesaurus_url].label }}
                    </ui-select-match>
                    <ui-select-choices repeat="sc in $ctrl.attributeColumns | filter: $select.search">
                        <span ng-bind-html="$ctrl.concepts[sc.thesaurus_url].label | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group" ng-if="$ctrl.actionColumns.length > 0">
            <label class="control-label col-md-2" translate="analysis.popup.attribute"></label>:
            <div class="col-md-10">
                <ui-select ng-model="$ctrl.tmpAction" on-select="$ctrl.getSubPopover($item, $ctrl.relation)">
                    <ui-select-match allow-clear="false">
                        {{ $select.selected }}
                    </ui-select-match>
                    <ui-select-choices repeat="sc in $ctrl.actionColumns | filter: $select.search">
                        <span ng-bind-html="sc | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group" ng-show="$ctrl.functionColumns.length > 0">
            <label class="control-label col-md-2" translate="analysis.popup.function"></label>:
            <div class="col-md-10">
                <ui-select ng-model="$ctrl.selectedFunc" on-select="$ctrl.functionSelected()">
                    <ui-select-match allow-clear="false">
                        {{ $select.selected.label }}
                    </ui-select-match>
                    <ui-select-choices repeat="f in $ctrl.functionColumns | filter: $select.search">
                        <span ng-bind-html="f.label | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group" ng-if="$ctrl.selectedFunc.needs_value">
            <label class="control-label col-md-2" translate="analysis.popup.function-values"></label>:
            <div class="col-md-10">
                <input type="text" class="form-control" ng-model="$ctrl.selectedFunc_value" />
            </div>
        </div>
        <div class="form-group" ng-show="$ctrl.selectedComps.length > 0">
            <label class="control-label col-md-2" translate="analysis.popup.comparison"></label>:
            <div class="col-md-10">
                <ui-select ng-model="$ctrl.selectedComp">
                    <ui-select-match allow-clear="false">
                        {{ $select.selected.label | translate }}
                    </ui-select-match>
                    <ui-select-choices repeat="c in $ctrl.selectedComps | filter: $select.search">
                        <span ng-bind-html="c.label | translate | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="form-group" ng-if="$ctrl.selectedComp.needs_value">
            <label class="control-label col-md-2" translate="analysis.popup.comparison-value"></label>:
            <div class="col-md-10" ng-if="$ctrl.selectedComp.id != 'between' && $ctrl.selectedComp.id != 'not_between' && $ctrl.selectedComp.id != 'in' && $ctrl.selectedComp.id != 'not_in'">
                <input type="text" class="form-control" ng-if="$ctrl.selectedType == 'string'" ng-model="$ctrl.selectedComp_value" />
                <input type="number" step="1" class="form-control" ng-if="$ctrl.selectedType == 'integer' || $ctrl.selectedType == 'double' || $ctrl.selectedType == 'count'" ng-model="$ctrl.selectedComp_value" />
                <div ng-if="$ctrl.selectedType == 'percentage'">
                    <input class="form-control slider" type="range" step="1" min="0" max="100" value="0" ng-model="$ctrl.selectedComp_value" />
                    <span class="slider-text">{{ $ctrl.selectedComp_value }}%</span>
                </div>
                <input type="color" class="form-control" ng-if="$ctrl.selectedType == 'color'" ng-model="$ctrl.selectedComp_value" />
                <div ng-if="$ctrl.selectedType == 'date'">
                    <input type="text" class="form-control" uib-datepicker-popup="{{ 'date_format_lg' | translate }}" is-open="opened" close-text="{{ 'close' | translate }}" ng-model="$ctrl.selectedComp_value"  ng-model-options="{timezone:'utc'}" />
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-init="opened=false" ng-click="opened=!opened"><i class="material-icons">event</i></button>
                    </span>
                </div>
                <ui-select ng-model="$ctrl.tmpContext" ng-if="$ctrl.contextColumns.length > 0" on-select="$ctrl.setContextTypeValue($item, $ctrl.relation.name)">
                    <ui-select-match allow-clear="false">
                        {{ $ctrl.concepts[$select.selected.thesaurus_url].label }}
                    </ui-select-match>
                    <ui-select-choices repeat="sc in $ctrl.contextColumns | filter: $select.search">
                        <span ng-bind-html="$ctrl.concepts[sc.thesaurus_url].label | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
                <ui-select ng-model="$ctrl.tmpDatatype" ng-if="$ctrl.datatypeColumns.length > 0" on-select="$ctrl.setDataTypeValue($item, $ctrl.relation.name)">
                    <ui-select-match allow-clear="false">
                        <span translate="{{$select.selected.description}}"></span>
                    </ui-select-match>
                    <ui-select-choices repeat="dc in $ctrl.datatypeColumns | filter: $select.search">
                        <span translate="{{dc.description}}"></span>
                    </ui-select-choices>
                </ui-select>
                <ui-select ng-model="$ctrl.tmpGeotype" ng-if="$ctrl.geoTypeColumns.length > 0" on-select="$ctrl.setGeoTypeValue($item, $ctrl.relation.name)">
                    <ui-select-match allow-clear="false">
                        {{ $select.selected }}
                    </ui-select-match>
                    <ui-select-choices repeat="gc in $ctrl.geoTypeColumns | filter: $select.search">
                        <span ng-bind-html="gc | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div class="col-md-10" ng-if="$ctrl.selectedComp.id == 'between' || $ctrl.selectedComp.id == 'not_between'">
                From: <input type="number" step="1" class="form-control" ng-if="$ctrl.selectedType == 'integer' || $ctrl.selectedType == 'double'" ng-model="$ctrl.selectedComp_value[0]" />
                <div ng-if="$ctrl.selectedType == 'percentage'">
                    <input class="form-control slider" type="range" step="1" min="0" max="100" value="0" ng-model="$ctrl.selectedComp_value[0]" />
                    <span class="slider-text">{{ $ctrl.selectedComp_value[0] }}%</span>
                </div>
                <input type="color" class="form-control" ng-if="$ctrl.selectedType == 'color'" ng-model="$ctrl.selectedComp_value[0]" />
                <div ng-if="$ctrl.selectedType == 'date'">
                    <input type="text" class="form-control" uib-datepicker-popup="{{ 'date_format_lg' | translate }}" is-open="opened" close-text="{{ 'close' | translate }}" ng-model="$ctrl.selectedComp_value[0]"  ng-model-options="{timezone:'utc'}" />
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-init="opened=false" ng-click="opened=!opened"><i class="material-icons">event</i></button>
                    </span>
                </div>
                To: <input type="number" step="1" class="form-control" ng-if="$ctrl.selectedType == 'integer' || $ctrl.selectedType == 'double'" ng-model="$ctrl.selectedComp_value[1]" />
                <div ng-if="$ctrl.selectedType == 'percentage'">
                    <input class="form-control slider" type="range" step="1" min="0" max="100" value="0" ng-model="$ctrl.selectedComp_value[1]" />
                    <span class="slider-text">{{ $ctrl.selectedComp_value[1] }}%</span>
                </div>
                <input type="color" class="form-control" ng-if="$ctrl.selectedType == 'color'" ng-model="$ctrl.selectedComp_value[1]" />
                <div ng-if="$ctrl.selectedType == 'date'">
                    <input type="text" class="form-control" uib-datepicker-popup="{{ 'date_format_lg' | translate }}" is-open="opened" close-text="{{ 'close' | translate }}" ng-model="$ctrl.selectedComp_value[1]"  ng-model-options="{timezone:'utc'}" />
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-init="opened=false" ng-click="opened=!opened"><i class="material-icons">event</i></button>
                    </span>
                </div>
            </div>
            <div class="col-md-10" ng-if="$ctrl.selectedComp.id == 'in' || $ctrl.selectedComp.id == 'not_in'" ng-init="$ctrl.selectedComp_value = []">
                <ul>
                    <li ng-repeat="part in $ctrl.selectedComp_value">
                        {{ part }}
                    </li>
                </ul>
                <input type="text" class="form-control" ng-if="$ctrl.selectedType == 'string'" ng-model="$ctrl.tmpInValue" />
                <input type="number" step="1" class="form-control" ng-if="$ctrl.selectedType == 'integer' || $ctrl.selectedType == 'double' || $ctrl.selectedType == 'count'" ng-model="$ctrl.tmpInValue" />
                <div ng-if="$ctrl.selectedType == 'percentage'">
                    <input class="form-control slider" type="range" step="1" min="0" max="100" value="0" ng-model="$ctrl.tmpInValue" />
                    <span class="slider-text">{{ $ctrl.tmpInValue }}%</span>
                </div>
                <input type="color" class="form-control" ng-if="$ctrl.selectedType == 'color'" ng-model="$ctrl.tmpInValue" />
                <div ng-if="$ctrl.selectedType == 'date'">
                    <input type="text" class="form-control" uib-datepicker-popup="{{ 'date_format_lg' | translate }}" is-open="opened" close-text="{{ 'close' | translate }}" ng-model="$ctrl.tmpInValue"  ng-model-options="{timezone:'utc'}" />
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-init="opened=false" ng-click="opened=!opened"><i class="material-icons">event</i></button>
                    </span>
                </div>
                <button type="button" class="btn btn-primary" ng-click="$ctrl.selectedComp_value.push($ctrl.tmpInValue)">Add</button>
            </div>
        </div>
        <div class="flex-hr-center">
            <button type="button" class="btn btn-default" ng-click="$ctrl.addFilter($ctrl.selectedColumn, $ctrl.selectedComp, $ctrl.selectedComp_value, $ctrl.selectedFunc.comp, $ctrl.selectedFunc_value, true, $ctrl.relation)" ng-disabled="(!$ctrl.selectedComp || ($ctrl.selectedComp.needs_value && !$ctrl.selectedComp_value)) && (!$ctrl.selectedFunc || ($ctrl.selectedFunc.needs_value && !$ctrl.selectedFunc_value))">
                <span translate="analysis.and-button"></span>
            </button>
            <button type="button" class="btn btn-default" ng-click="$ctrl.addFilter($ctrl.selectedColumn, $ctrl.selectedComp, $ctrl.selectedComp_value, $ctrl.selectedFunc.comp, $ctrl.selectedFunc_value, false, $ctrl.relation)" ng-disabled="(!$ctrl.selectedComp || ($ctrl.selectedComp.needs_value && !$ctrl.selectedComp_value)) && (!$ctrl.selectedFunc || ($ctrl.selectedFunc.needs_value && !$ctrl.selectedFunc_value))">
                <span translate="analysis.or-button"></span>
            </button>
        </div>
    </form>
</div>
