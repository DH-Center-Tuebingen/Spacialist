<div ng-controller="mainCtrl" resize-watcher>
    <div class="col-md-2" id="tree-container">
        <h3>Elemente</h3>
        <my-tree on-init="getContextList()" on-click-callback="setCurrentElement(target, elem)" item-list="contextList" element="currentElement" display-attribute="'name'" type-attribute="'typename'" prefix-attribute="'typelabel'" set-context-menu="newElementContextMenu"></my-tree>
        <spinner ng-if="getContextListStarted"></spinner>
    </div>
    <div class="col-md-5" style="border-right: 1px solid #ddd; border-left: 1px solid #ddd;" id="attribute-container">
        <div ng-show="currentElement">
            <h3>{{ currentElement.name }}<span ng-if="currentElement.typeLabel" class="type-desc">{{ currentElement.typeLabel }}</span> <small>Element-Eigenschaften</small></h3>
            <form class="form-horizontal" role="form" ng-if="currentElementFields">
                <div class="form-group">
                    <label class="control-label col-md-3" for="name">
                        Name:
                    </label>
                    <div class="col-md-9">
                        <input type="text" class="form-control" id="name" ng-model="currentElement.name" />
                    </div>
                </div>
                <form-field fields="currentElementFields" output="currentElementData" label-width="3" input-width="9" offset="0">
                </form-field>
                <div class="col-md-offset-3">
                    <button type="button" class="btn btn-success" ng-click="storeElement(currentElement, currentElementData)">
                        <span class="fa fa-fw fa-floppy-o"></span> {{ 'Save' | translate }}
                    </button>
                    <button type="button" class="btn btn-danger" ng-click="deleteElement(currentElement)">
                        <span class="fa fa-fw fa-trash-o"></span> {{ 'delete' | translate }}
                    </button>
                </div>
            </form>
        </div>
        <div ng-hide="currentElement">
            <h3>Element-Eigenschaften</h3>
            <div class="alert alert-info">
                <p>
                    Kein Element ausgewählt.
                </p>
                <p>
                    Um die Eigenschaften eines Elements anzuzeigen, klicken Sie in der Baumansicht auf ein Element.
                </p>
            </div>
        </div>
    </div>
    <div class="col-md-5" id="addon-container">
        <ul class="nav nav-tabs" id="addon-nav">
            <li role="presentation" ng-class="{ active: layerTwo.activeTab == 'map'}" ng-if="moduleExists('mapCtrl')">
                <a href="" ng-click="setActiveTab('map')"><span class="fa fa-fw fa-map-marker"></span><span class="tab-desc"> Karte</span></a>
            </li>
            <li role="presentation" ng-class="{ active: layerTwo.activeTab == 'properties'}" ng-if="currentElement.furtherProperties">
                <a href="" ng-click="setActiveTab('properties')"><span class="fa fa-fw fa-sliders"></span><span class="tab-desc"> Weitere Eigenschaften</span></a>
            </li>
            <li role="presentation" ng-class="{ active: layerTwo.activeTab == 'harris'}" ng-if="moduleExists('harrisCtrl')">
                <a href="" ng-click="setActiveTab('harris')"><span class="fa fa-fw fa-object-group"></span><span class="tab-desc"> Harris-Matrix</span></a>
            </li>
            <li role="presentation" ng-class="{ active: layerTwo.activeTab == 'images'}" ng-if="moduleExists('imageCtrl')">
                <a href="" ng-click="setActiveTab('images')"><span class="fa fa-fw fa-image"></span><span class="tab-desc"> Bilder</span></a>
            </li>
            <li role="presentation" ng-class="{ active: layerTwo.activeTab == 'literature'}" ng-if="moduleExists('literatureCtrl')">
                <a href="" ng-click="setActiveTab('literature')"><span class="fa fa-fw fa-book"></span><span class="tab-desc"> Literatur</span></a>
            </li>
        </ul>
        <div ng-if="layerTwo.activeTab == 'map'">
            <div id="map-container" ng-if="sideNav.mapTab && map">
                <leaflet bounds="mapBounds" layers="map.layers" lf-draw="map.drawOptions" controls="map.controls" markers="markers" event-broadcast="map.events" height="{{addonContainerHeight}}px" width="100%">
                    <layercontrol order="normal" icons="map.layercontrol.icons" auto-hide-opacity="true" show-groups="true" title="" base-title="Base Layers" overlays-title="Overlays"></layercontrol>
                </leaflet>
            </div>
        </div>
        <div ng-if="layerTwo.activeTab == 'properties'">
            <h5>Properties active</h5>
        </div>
        <div ng-if="layerTwo.activeTab == 'harris'">
            <h5>Harris active</h5>
        </div>
        <div ng-if="layerTwo.activeTab == 'images'" ng-controller="imageCtrl" ng-init="initImageTab()" style="max-height: 100%;">
            <uib-accordion close-others="true">
                <div uib-accordion-group class="panel-default" is-open="layerTwo.imageTab.linkedOpen" is-disabled="!currentElement">
                    <uib-accordion-heading>
                        <span ng-click="!currentElement || updateLinkedImages(layerTwo.imageTab.linkedOpen)">
                            Linked images
                        </span><!-- <span class="badge">{{ images.linked.length }}</span>-->
                    </uib-accordion-heading>
                    <image-list on-scroll-load="loadImages(len, type)" image-data="images.linked" image-type="'linked'" scroll-container="'#addon-container'"></image-list>
                </div>
                <div uib-accordion-group class="panel-default" is-open="layerTwo.imageTab.newOpen">
                    <uib-accordion-heading>
                        {{ 'add new images' | translate }}
                    </uib-accordion-heading>
                    <div class="col-md-12">
                        <div class="alert alert-info drop-box" ngf-drop ngf-select ng-model="dropFiles" ngf-drag-over-class="'dragover'" ngf-multiple="true" ngf-allow-dir="false" accept="image/*" ngf-pattern="'image/*'">
                            Entweder per Drag &amp; Drop hierherziehen oder über den Button hochladen.
                        </div>
                        <button type="button" class="btn btn-default" ngf-select="uploadImages($files, $invalidFiles)" multiple accept="image/*">Bilder hochladen</button>
                        <ul>
                            <li ng-repeat="f in uploadingImages">
                                {{ f.name }} {{ f.$errorParam }}
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: {{ f.progress }}%">
                                        <span ng-hide="f.progress < 100">
                                            {{ 'upload finished' | translate }}
                                        </span>
                                        <span ng-show="f.progress < 100">
                                            {{ f.progress }}%
                                        </span>
                                    </div>
                                </div>
                            </li>
                            <li ng-repeat="f in errFiles">{{f.name}} {{f.$error}} {{f.$errorParam}}
                            </li>
                        </ul>
                    </div>
                </div>
                <div uib-accordion-group class="panel-default" is-open="layerTwo.imageTab.allOpen">
                    <uib-accordion-heading>
                        <span ng-click="updateAllImages(layerTwo.imageTab.allOpen)">
                            Alle Bilder
                        </span><!-- <span class="badge">{{ images.all.length }}</span>-->
                    </uib-accordion-heading>
                    <image-list on-scroll-load="loadImages(len, type)" image-data="images.all" image-type="'all'" scroll-container="'#addon-container'"></image-list>
                </div>
            </uib-accordion>
        </div>
        <div ng-if="layerTwo.activeTab == 'literature'" ng-controller="literatureCtrl">
            <h3>Neue Literatur hinzufügen</h3>
            <form class="form-horizontal">
                <div class="form-group">
                    <label class="control-label col-md-3" for="type">Typ:</label>
                    <div class="col-md-9">
                        <ui-select ng-model="literature.selectedType">
                            <ui-select-match>
                                <span ng-bind="$select.selected.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="type in availableTypes">
                                <span ng-bind="type.name"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
                <div class="form-group" ng-repeat="mandatory in availableTypes[literature.selectedType.id].mandatoryFields">
                    <label class="control-label col-md-3">{{ mandatory }}:<span style="color: red;">*</span></label>
                    <div class="col-md-9">
                        <input type="text" class="form-control" ng-model="literature.fields[mandatory]" placeholder="{{ mandatory }}"/>
                    </div>
                </div>
                <div class="form-group" ng-repeat="optional in availableTypes[literature.selectedType.id].optionalFields">
                    <label class="control-label col-md-3">{{ optional }}:</label>
                    <div class="col-md-9">
                        <input type="text" class="form-control" ng-model="literature.fields[optional]" placeholder="{{ optional }}"/>
                    </div>
                </div>
            </form>
            <h4>BibTex-Code</h4>
            <pre>
                <code>
{{ literature.fields }}
@ARTICLE {
    author = "Bruce Wayne",
    title = "Batman",
    journal = "XY"
    year = "1337"
}
                </code>
            </pre>
        </div>
    </div>
</div>
